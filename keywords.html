<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>User defined keywords | Ajv JSON schema validator</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
    <meta name="description" content="The fastest JSON schema Validator. Supports JSON Schema draft-04/06/07/2019-09/2020-12 and JSON Type Definition (RFC8927)">
    <meta charset="utf-8">
    <meta property="og:title" content="Ajv JSON schema validator">
    <meta property="og:description" content="The fastest JSON schema Validator. Supports JSON Schema draft-04/06/07/2019-09/2020-12 and JSON Type Definition (RFC8927)">
    <meta property="og:image" content="https://ajv.js.org/img/ajv.png">
    <meta itemprop="image" content="https://ajv.js.org/img/ajv.png">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Ajv JSON schema validator">
    <meta name="twitter:image:src" content="https://ajv.js.org/img/ajv.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preload" href="/assets/css/0.styles.f62b8f28.css" as="style"><link rel="preload" href="/assets/js/app.329991f7.js" as="script"><link rel="preload" href="/assets/js/3.9bef8dc3.js" as="script"><link rel="preload" href="/assets/js/4.bc735718.js" as="script"><link rel="preload" href="/assets/js/18.77b5141f.js" as="script"><link rel="preload" href="/assets/js/50.85d21782.js" as="script"><link rel="preload" href="/assets/js/26.d39d70b1.js" as="script"><link rel="prefetch" href="/assets/js/10.f6ccd31a.js"><link rel="prefetch" href="/assets/js/11.889f7473.js"><link rel="prefetch" href="/assets/js/12.de579250.js"><link rel="prefetch" href="/assets/js/13.f6ba9e8b.js"><link rel="prefetch" href="/assets/js/14.25a51458.js"><link rel="prefetch" href="/assets/js/15.1c771a71.js"><link rel="prefetch" href="/assets/js/16.14f36514.js"><link rel="prefetch" href="/assets/js/17.ce901d66.js"><link rel="prefetch" href="/assets/js/19.44d523fd.js"><link rel="prefetch" href="/assets/js/2.d8f39153.js"><link rel="prefetch" href="/assets/js/20.6e0a7113.js"><link rel="prefetch" href="/assets/js/21.eece2194.js"><link rel="prefetch" href="/assets/js/22.7a390fc6.js"><link rel="prefetch" href="/assets/js/23.80989a2c.js"><link rel="prefetch" href="/assets/js/24.447f8cee.js"><link rel="prefetch" href="/assets/js/25.dfe5b2e5.js"><link rel="prefetch" href="/assets/js/27.a6a45664.js"><link rel="prefetch" href="/assets/js/28.cc792f16.js"><link rel="prefetch" href="/assets/js/29.377ecf83.js"><link rel="prefetch" href="/assets/js/30.e7b1cb92.js"><link rel="prefetch" href="/assets/js/31.1ccf3e36.js"><link rel="prefetch" href="/assets/js/32.17da81bb.js"><link rel="prefetch" href="/assets/js/33.3a16ba47.js"><link rel="prefetch" href="/assets/js/34.6a10caa1.js"><link rel="prefetch" href="/assets/js/35.81693670.js"><link rel="prefetch" href="/assets/js/36.b4bb7e55.js"><link rel="prefetch" href="/assets/js/37.917d9097.js"><link rel="prefetch" href="/assets/js/38.5e223ad3.js"><link rel="prefetch" href="/assets/js/39.63c25995.js"><link rel="prefetch" href="/assets/js/40.e08eb88e.js"><link rel="prefetch" href="/assets/js/41.b920110a.js"><link rel="prefetch" href="/assets/js/42.93341fcf.js"><link rel="prefetch" href="/assets/js/43.b31d7e14.js"><link rel="prefetch" href="/assets/js/44.c606fe7b.js"><link rel="prefetch" href="/assets/js/45.19963455.js"><link rel="prefetch" href="/assets/js/46.4fa56bbb.js"><link rel="prefetch" href="/assets/js/47.7f296c5b.js"><link rel="prefetch" href="/assets/js/48.8b6637b0.js"><link rel="prefetch" href="/assets/js/49.6f50140b.js"><link rel="prefetch" href="/assets/js/5.6a0adbf7.js"><link rel="prefetch" href="/assets/js/51.7f266bea.js"><link rel="prefetch" href="/assets/js/52.2acf2b1a.js"><link rel="prefetch" href="/assets/js/53.3351e05f.js"><link rel="prefetch" href="/assets/js/54.7f5e233e.js"><link rel="prefetch" href="/assets/js/55.9fb11c19.js"><link rel="prefetch" href="/assets/js/56.480e48ed.js"><link rel="prefetch" href="/assets/js/57.7eb38371.js"><link rel="prefetch" href="/assets/js/58.4bfaec27.js"><link rel="prefetch" href="/assets/js/59.95432bc3.js"><link rel="prefetch" href="/assets/js/6.54410b71.js"><link rel="prefetch" href="/assets/js/60.ee042a00.js"><link rel="prefetch" href="/assets/js/61.a6e948fd.js"><link rel="prefetch" href="/assets/js/62.c16511fb.js"><link rel="prefetch" href="/assets/js/63.2363888c.js"><link rel="prefetch" href="/assets/js/64.633db9b4.js"><link rel="prefetch" href="/assets/js/65.0447bbb5.js"><link rel="prefetch" href="/assets/js/66.2dea325f.js"><link rel="prefetch" href="/assets/js/67.40b6dcfd.js"><link rel="prefetch" href="/assets/js/68.fa0a1145.js"><link rel="prefetch" href="/assets/js/69.219251f6.js"><link rel="prefetch" href="/assets/js/7.cbcaae39.js"><link rel="prefetch" href="/assets/js/8.974087da.js"><link rel="prefetch" href="/assets/js/9.7c721237.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f62b8f28.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/ajv.svg" alt="Ajv JSON schema validator" class="logo"> <span class="site-name can-hide">Ajv JSON schema validator</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guide" class="dropdown-title"><span class="title">Guide</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guide" class="mobile-dropdown-title"><span class="title">Guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/why-ajv.html" class="nav-link">
  Why use Ajv
</a></li><li class="dropdown-item"><!----> <a href="/guide/getting-started.html" class="nav-link">
  Getting started
</a></li><li class="dropdown-item"><!----> <a href="/guide/typescript.html" class="nav-link">
  Using with TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/guide/schema-language.html" class="nav-link">
  Choosing schema language
</a></li><li class="dropdown-item"><!----> <a href="/guide/managing-schemas.html" class="nav-link">
  Managing schemas
</a></li><li class="dropdown-item"><!----> <a href="/guide/combining-schemas.html" class="nav-link">
  Combining schemas
</a></li><li class="dropdown-item"><!----> <a href="/guide/formats.html" class="nav-link">
  Format validation
</a></li><li class="dropdown-item"><!----> <a href="/guide/modifying-data.html" class="nav-link">
  Modifying data
</a></li><li class="dropdown-item"><!----> <a href="/guide/user-keywords.html" class="nav-link">
  User-defined keywords
</a></li><li class="dropdown-item"><!----> <a href="/guide/async-validation.html" class="nav-link">
  Asynchronous validation
</a></li><li class="dropdown-item"><!----> <a href="/guide/environments.html" class="nav-link">
  Execution environments
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Reference" class="dropdown-title"><span class="title">Reference</span> <span class="arrow down"></span></button> <button type="button" aria-label="Reference" class="mobile-dropdown-title"><span class="title">Reference</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/api.html" class="nav-link">
  API Reference
</a></li><li class="dropdown-item"><!----> <a href="/options.html" class="nav-link">
  Ajv options
</a></li><li class="dropdown-item"><!----> <a href="/json-schema.html" class="nav-link">
  JSON Schema
</a></li><li class="dropdown-item"><!----> <a href="/json-type-definition.html" class="nav-link">
  JSON Type Definition
</a></li><li class="dropdown-item"><!----> <a href="/strict-mode.html" class="nav-link">
  Strict mode
</a></li><li class="dropdown-item"><!----> <a href="/standalone.html" class="nav-link">
  Standalone validation code
</a></li><li class="dropdown-item"><!----> <a href="/keywords.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  User defined keywords
</a></li><li class="dropdown-item"><!----> <a href="/coercion.html" class="nav-link">
  Type coercion rules
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Learn more" class="dropdown-title"><span class="title">Learn more</span> <span class="arrow down"></span></button> <button type="button" aria-label="Learn more" class="mobile-dropdown-title"><span class="title">Learn more</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Extending Ajv
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/packages/" class="nav-link">
  Extending Ajv
</a></li><li class="dropdown-subitem"><a href="/packages/ajv-cli.html" class="nav-link">
  ajv-cli
</a></li><li class="dropdown-subitem"><a href="/packages/ajv-errors.html" class="nav-link">
  ajv-errors
</a></li><li class="dropdown-subitem"><a href="/packages/ajv-formats.html" class="nav-link">
  ajv-formats
</a></li><li class="dropdown-subitem"><a href="/packages/ajv-i18n.html" class="nav-link">
  ajv-i18n
</a></li><li class="dropdown-subitem"><a href="/packages/ajv-keywords.html" class="nav-link">
  ajv-keywords
</a></li></ul></li><li class="dropdown-item"><h4>
          Contributors
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/contributing.html" class="nav-link">
  Contributing guide
</a></li><li class="dropdown-subitem"><a href="/codegen.html" class="nav-link">
  Code generation design
</a></li><li class="dropdown-subitem"><a href="/components.html" class="nav-link">
  Code components
</a></li><li class="dropdown-subitem"><a href="/code_of_conduct.html" class="nav-link">
  Code of Conduct
</a></li></ul></li><li class="dropdown-item"><h4>
          Information
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/news/" class="nav-link">
  News
</a></li><li class="dropdown-subitem"><a href="/faq.html" class="nav-link">
  FAQ
</a></li><li class="dropdown-subitem"><a href="/security.html" class="nav-link">
  Security
</a></li><li class="dropdown-subitem"><a href="/v6-to-v8-migration.html" class="nav-link">
  Migrate from v6
</a></li><li class="dropdown-subitem"><a href="/testimonials.html" class="nav-link">
  What users say
</a></li><li class="dropdown-subitem"><a href="/license.html" class="nav-link">
  License
</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guide" class="dropdown-title"><span class="title">Guide</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guide" class="mobile-dropdown-title"><span class="title">Guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/why-ajv.html" class="nav-link">
  Why use Ajv
</a></li><li class="dropdown-item"><!----> <a href="/guide/getting-started.html" class="nav-link">
  Getting started
</a></li><li class="dropdown-item"><!----> <a href="/guide/typescript.html" class="nav-link">
  Using with TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/guide/schema-language.html" class="nav-link">
  Choosing schema language
</a></li><li class="dropdown-item"><!----> <a href="/guide/managing-schemas.html" class="nav-link">
  Managing schemas
</a></li><li class="dropdown-item"><!----> <a href="/guide/combining-schemas.html" class="nav-link">
  Combining schemas
</a></li><li class="dropdown-item"><!----> <a href="/guide/formats.html" class="nav-link">
  Format validation
</a></li><li class="dropdown-item"><!----> <a href="/guide/modifying-data.html" class="nav-link">
  Modifying data
</a></li><li class="dropdown-item"><!----> <a href="/guide/user-keywords.html" class="nav-link">
  User-defined keywords
</a></li><li class="dropdown-item"><!----> <a href="/guide/async-validation.html" class="nav-link">
  Asynchronous validation
</a></li><li class="dropdown-item"><!----> <a href="/guide/environments.html" class="nav-link">
  Execution environments
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Reference" class="dropdown-title"><span class="title">Reference</span> <span class="arrow down"></span></button> <button type="button" aria-label="Reference" class="mobile-dropdown-title"><span class="title">Reference</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/api.html" class="nav-link">
  API Reference
</a></li><li class="dropdown-item"><!----> <a href="/options.html" class="nav-link">
  Ajv options
</a></li><li class="dropdown-item"><!----> <a href="/json-schema.html" class="nav-link">
  JSON Schema
</a></li><li class="dropdown-item"><!----> <a href="/json-type-definition.html" class="nav-link">
  JSON Type Definition
</a></li><li class="dropdown-item"><!----> <a href="/strict-mode.html" class="nav-link">
  Strict mode
</a></li><li class="dropdown-item"><!----> <a href="/standalone.html" class="nav-link">
  Standalone validation code
</a></li><li class="dropdown-item"><!----> <a href="/keywords.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  User defined keywords
</a></li><li class="dropdown-item"><!----> <a href="/coercion.html" class="nav-link">
  Type coercion rules
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Learn more" class="dropdown-title"><span class="title">Learn more</span> <span class="arrow down"></span></button> <button type="button" aria-label="Learn more" class="mobile-dropdown-title"><span class="title">Learn more</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Extending Ajv
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/packages/" class="nav-link">
  Extending Ajv
</a></li><li class="dropdown-subitem"><a href="/packages/ajv-cli.html" class="nav-link">
  ajv-cli
</a></li><li class="dropdown-subitem"><a href="/packages/ajv-errors.html" class="nav-link">
  ajv-errors
</a></li><li class="dropdown-subitem"><a href="/packages/ajv-formats.html" class="nav-link">
  ajv-formats
</a></li><li class="dropdown-subitem"><a href="/packages/ajv-i18n.html" class="nav-link">
  ajv-i18n
</a></li><li class="dropdown-subitem"><a href="/packages/ajv-keywords.html" class="nav-link">
  ajv-keywords
</a></li></ul></li><li class="dropdown-item"><h4>
          Contributors
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/contributing.html" class="nav-link">
  Contributing guide
</a></li><li class="dropdown-subitem"><a href="/codegen.html" class="nav-link">
  Code generation design
</a></li><li class="dropdown-subitem"><a href="/components.html" class="nav-link">
  Code components
</a></li><li class="dropdown-subitem"><a href="/code_of_conduct.html" class="nav-link">
  Code of Conduct
</a></li></ul></li><li class="dropdown-item"><h4>
          Information
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/news/" class="nav-link">
  News
</a></li><li class="dropdown-subitem"><a href="/faq.html" class="nav-link">
  FAQ
</a></li><li class="dropdown-subitem"><a href="/security.html" class="nav-link">
  Security
</a></li><li class="dropdown-subitem"><a href="/v6-to-v8-migration.html" class="nav-link">
  Migrate from v6
</a></li><li class="dropdown-subitem"><a href="/testimonials.html" class="nav-link">
  What users say
</a></li><li class="dropdown-subitem"><a href="/license.html" class="nav-link">
  License
</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Reference</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/api.html" class="sidebar-link">API Reference</a></li><li><a href="/options.html" class="sidebar-link">Ajv options</a></li><li><a href="/json-schema.html" class="sidebar-link">JSON Schema</a></li><li><a href="/json-type-definition.html" class="sidebar-link">JSON Type Definition</a></li><li><a href="/strict-mode.html" class="sidebar-link">Strict mode</a></li><li><a href="/standalone.html" class="sidebar-link">Standalone validation code</a></li><li><a href="/keywords.html" aria-current="page" class="active sidebar-link">User defined keywords</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/keywords.html#common-attributes-of-keyword-definitions" class="sidebar-link">Common attributes of keyword definitions</a></li><li class="sidebar-sub-header"><a href="/keywords.html#schema-compilation-context" class="sidebar-link">Schema compilation context</a></li><li class="sidebar-sub-header"><a href="/keywords.html#validation-time-variables" class="sidebar-link">Validation time variables</a></li><li class="sidebar-sub-header"><a href="/keywords.html#reporting-errors" class="sidebar-link">Reporting errors</a></li></ul></li><li><a href="/coercion.html" class="sidebar-link">Type coercion rules</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Extending Ajv</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Contributors</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Information</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="user-defined-keywords"><a href="#user-defined-keywords" class="header-anchor">#</a> User defined keywords</h1> <p></p><div class="table-of-contents"><ul><li><a href="#common-attributes-of-keyword-definitions">Common attributes of keyword definitions</a><ul><li><a href="#define-keyword-with-code-generation-function">Define keyword with code generation function <span class="badge tip" style="vertical-align:top;" data-v-6eb0829b>recommended</span></a></li><li><a href="#define-keyword-with-validate-function">Define keyword with &quot;validate&quot; function</a></li><li><a href="#define-keyword-with-compile-function">Define keyword with &quot;compile&quot; function</a></li><li><a href="#define-keyword-with-macro-function">Define keyword with &quot;macro&quot; function</a></li></ul></li><li><a href="#schema-compilation-context">Schema compilation context</a></li><li><a href="#validation-time-variables">Validation time variables</a></li><li><a href="#reporting-errors">Reporting errors</a></li></ul></div><p></p> <h2 id="common-attributes-of-keyword-definitions"><a href="#common-attributes-of-keyword-definitions" class="header-anchor">#</a> Common attributes of keyword definitions</h2> <p>The usual interface to define all keywords has these properties:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">_KeywordDef</span> <span class="token punctuation">{</span>
  keyword<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
  type<span class="token operator">?</span><span class="token operator">:</span> JSONType <span class="token operator">|</span> JSONType<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// data type(s) that keyword applies to,</span>
  <span class="token comment">// if defined, it is usually &quot;string&quot;, &quot;number&quot;, &quot;object&quot; or &quot;array&quot;</span>
  schemaType<span class="token operator">?</span><span class="token operator">:</span> JSONType <span class="token operator">|</span> JSONType<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// the allowed type(s) of value that keyword must have in the schema</span>
  error<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    message<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>cxt<span class="token operator">:</span> KeywordCxt<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Code<span class="token punctuation">)</span>
    params<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>cxt<span class="token operator">:</span> KeywordCxt<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Code
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Keyword definitions may have additional optional properties - see <a href="https://github.com/ajv-validator/ajv/blob/master/lib/types/index.ts" target="_blank" rel="noopener noreferrer">types<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://github.com/ajv-validator/ajv/blob/master/lib/compile/context.ts" target="_blank" rel="noopener noreferrer">KeywordCxt<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="define-keyword-with-code-generation-function"><a href="#define-keyword-with-code-generation-function" class="header-anchor">#</a> Define keyword with code generation function <span class="badge tip" style="vertical-align:top;" data-v-6eb0829b>recommended</span></h3> <p>Starting from v7 Ajv uses <a href="https://github.com/ajv-validator/ajv/blob/master/lib/compile/codegen/index.ts" target="_blank" rel="noopener noreferrer">CodeGen module<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for all pre-defined keywords - see <a href="/codegen.html">codegen.md</a> for details.</p> <p>This is the best approach for user defined keywords:</p> <ul><li>safe against code injection</li> <li>best performance</li> <li>the precise control over validation process</li> <li>access to the parent data and the path to the currently validated data</li></ul> <p>While Ajv can be safely used with plain JavaScript, it is strongly recommended to use Typescript for user-defined keywords that generate code - the prevention against code injection via untrusted schemas is partially based on the type system, not only on runtime checks.</p> <p>The usual keyword definition for keywords generating code extends common interface with &quot;code&quot; function:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">CodeKeywordDefinition</span> <span class="token keyword">extends</span> <span class="token class-name">_KeywordDef</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">code</span><span class="token operator">:</span> <span class="token punctuation">(</span>cxt<span class="token operator">:</span> KeywordCxt<span class="token punctuation">,</span> ruleType<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span> <span class="token comment">// code generation function</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Example <code>even</code> keyword:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>_<span class="token punctuation">,</span> KeywordCxt<span class="token punctuation">}</span> from Ajv

ajv<span class="token punctuation">.</span><span class="token function">addKeyword</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  keyword<span class="token operator">:</span> <span class="token string">&quot;even&quot;</span><span class="token punctuation">,</span>
  type<span class="token operator">:</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">,</span>
  schemaType<span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// $data: true // to support [$data reference](./guide/combining-schemas.md#data-reference), ...</span>
  <span class="token function">code</span><span class="token punctuation">(</span>cxt<span class="token operator">:</span> KeywordCxt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>data<span class="token punctuation">,</span> schema<span class="token punctuation">}</span> <span class="token operator">=</span> cxt
    <span class="token keyword">const</span> op <span class="token operator">=</span> schema <span class="token operator">?</span> _<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">!==</span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> _<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">===</span><span class="token template-punctuation string">`</span></span>
    cxt<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span>_<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> %2 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>op<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 0</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">// ... the only code change needed is to use `cxt.fail$data` here</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">{</span>even<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> validate <span class="token operator">=</span> ajv<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>schema<span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre></div><p>Example <code>range</code> keyword:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>_<span class="token punctuation">,</span> nil<span class="token punctuation">,</span> KeywordCxt<span class="token punctuation">}</span> from Ajv

ajv<span class="token punctuation">.</span><span class="token function">addKeyword</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  keyword<span class="token operator">:</span> <span class="token string">&quot;range&quot;</span><span class="token punctuation">,</span>
  type<span class="token operator">:</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">,</span>
  <span class="token function">code</span><span class="token punctuation">(</span>cxt<span class="token operator">:</span> KeywordCxt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>schema<span class="token punctuation">,</span> parentSchema<span class="token punctuation">,</span> data<span class="token punctuation">}</span> <span class="token operator">=</span> cxt
    <span class="token keyword">const</span> <span class="token punctuation">[</span>min<span class="token punctuation">,</span> max<span class="token punctuation">]</span> <span class="token operator">=</span> schema
    <span class="token keyword">const</span> eq<span class="token operator">:</span> Code <span class="token operator">=</span> parentSchema<span class="token punctuation">.</span>exclusiveRange <span class="token operator">?</span> _<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">=</span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> nil
    cxt<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span>_<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> &lt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>eq<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>min<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> || </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> &gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>eq<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>max<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  metaSchema<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">&quot;array&quot;</span><span class="token punctuation">,</span>
    items<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    minItems<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    additionalItems<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>You can review pre-defined Ajv keywords in <a href="https://github.com/ajv-validator/ajv/blob/master/lib/validation" target="_blank" rel="noopener noreferrer">validation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> folder for more advanced examples - it is much easier to define code generation keywords than it was in the previous version of Ajv.</p> <p>See <a href="https://github.com/ajv-validator/ajv/blob/master/lib/compile/context.ts" target="_blank" rel="noopener noreferrer">KeywordCxt<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://github.com/ajv-validator/ajv/blob/master/lib/compile/index.ts" target="_blank" rel="noopener noreferrer">SchemaCxt<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> type definitions for more information about properties you can use in your keywords.</p> <h3 id="define-keyword-with-validate-function"><a href="#define-keyword-with-validate-function" class="header-anchor">#</a> Define keyword with &quot;validate&quot; function</h3> <p>Usual keyword definition for validation keywords:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">FuncKeywordDefinition</span> <span class="token keyword">extends</span> <span class="token class-name">_KeywordDef</span> <span class="token punctuation">{</span>
  validate<span class="token operator">?</span><span class="token operator">:</span> SchemaValidateFunction <span class="token operator">|</span> DataValidateFunction <span class="token comment">// DataValidateFunction requires `schema: false` option</span>
  schema<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token comment">// schema: false makes validate not to expect schema (DataValidateFunction)</span>
  modifying<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
  async<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
  valid<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
  errors<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> <span class="token string">&quot;full&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">SchemaValidateFunction</span> <span class="token punctuation">{</span>
  <span class="token punctuation">(</span>schema<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> data<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> parentSchema<span class="token operator">?</span><span class="token operator">:</span> AnySchemaObject<span class="token punctuation">,</span> dataCxt<span class="token operator">?</span><span class="token operator">:</span> DataValidationCxt<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token operator">|</span> <span class="token builtin">boolean</span>
    <span class="token operator">|</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span>
  errors<span class="token operator">?</span><span class="token operator">:</span> Partial<span class="token operator">&lt;</span>ErrorObject<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">DataValidateFunction</span> <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">:</span> Ajv <span class="token operator">|</span> <span class="token builtin">any</span><span class="token punctuation">,</span> data<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> dataCxt<span class="token operator">?</span><span class="token operator">:</span> DataValidationCxt<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span>
  errors<span class="token operator">?</span><span class="token operator">:</span> Partial<span class="token operator">&lt;</span>ErrorObject<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The function should return validation result as boolean. It can return an array of validation errors via <code>.errors</code> property of itself (otherwise a standard error will be used).</p> <p><code>validate</code> keywords are suitable for:</p> <ul><li>testing your keywords before converting them to compiled/code keywords</li> <li>defining keywords that do not depend on the schema value (e.g., when the value is always <code>true</code>). In this case you can add option <code>schema: false</code> to the keyword definition and the schemas won't be passed to the validation function, it will only receive the same parameters as compiled validation function.</li> <li>defining keywords where the schema is a value used in some expression.</li> <li>defining keywords that support <a href="/guide/combining-schemas.html#data-reference">$data reference</a> - in this case <code>validate</code> or <code>code</code> function is required, either as the only option or in addition to <code>compile</code> or <code>macro</code>.</li></ul> <p>Example: <code>constant</code> keyword (a synonym for draft-06 keyword <code>const</code>, it is equivalent to <code>enum</code> keyword with one item):</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>ajv<span class="token punctuation">.</span><span class="token function">addKeyword</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  keyword<span class="token operator">:</span> <span class="token string">&quot;constant&quot;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">validate</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">schema<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token keyword">typeof</span> schema <span class="token operator">==</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">&amp;&amp;</span> schema <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token function">deepEqual</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token operator">:</span> schema <span class="token operator">===</span> data<span class="token punctuation">,</span>
  errors<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">{</span>
  constant<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> validate <span class="token operator">=</span> ajv<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>schema<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span>

<span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">{</span>
  constant<span class="token operator">:</span> <span class="token punctuation">{</span>foo<span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> validate <span class="token operator">=</span> ajv<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>schema<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>foo<span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>foo<span class="token operator">:</span> <span class="token string">&quot;baz&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre></div><p><code>const</code> keyword is already available in Ajv.</p> <div class="custom-block tip"><p class="custom-block-title">Keywords that do not define errors</p> <p>If the keyword does not define errors (see <a href="/api.html#reporting-errors">Reporting errors</a>) pass <code>errors: false</code> in its definition; it will make generated code more efficient.</p></div> <p>To add asynchronous keyword pass <code>async: true</code> in its definition.</p> <h3 id="define-keyword-with-compile-function"><a href="#define-keyword-with-compile-function" class="header-anchor">#</a> Define keyword with &quot;compile&quot; function</h3> <p>The keyword is similar to &quot;validate&quot;, with the difference that &quot;compile&quot; property has function that will be called during schema compilation and should return validation function:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">FuncKeywordDefinition</span> <span class="token keyword">extends</span> <span class="token class-name">_KeywordDef</span> <span class="token punctuation">{</span>
  compile<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>schema<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> parentSchema<span class="token operator">:</span> AnySchemaObject<span class="token punctuation">,</span> it<span class="token operator">:</span> SchemaObjCxt<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> DataValidateFunction
  schema<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token comment">// schema: false makes validate not to expect schema (DataValidateFunction)</span>
  modifying<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
  async<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
  valid<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
  errors<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> <span class="token string">&quot;full&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In some cases it is the best approach to define keywords, but it has the performance cost of an extra function call during validation. If keyword logic can be expressed via some other JSON Schema then <code>macro</code> keyword definition is more efficient (see below).</p> <p>Example. <code>range</code> and <code>exclusiveRange</code> keywords using compiled schema:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>ajv<span class="token punctuation">.</span><span class="token function">addKeyword</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  keyword<span class="token operator">:</span> <span class="token string">&quot;range&quot;</span><span class="token punctuation">,</span>
  type<span class="token operator">:</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">,</span>
  <span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>min<span class="token punctuation">,</span> max<span class="token punctuation">]</span><span class="token punctuation">,</span> parentSchema</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> parentSchema<span class="token punctuation">.</span>exclusiveRange <span class="token operator">===</span> <span class="token boolean">true</span>
      <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> data <span class="token operator">&gt;</span> min <span class="token operator">&amp;&amp;</span> data <span class="token operator">&lt;</span> <span class="token function-variable function">max</span>
      <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> data <span class="token operator">&gt;=</span> min <span class="token operator">&amp;&amp;</span> data <span class="token operator">&lt;=</span> max
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  errors<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  metaSchema<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// schema to validate keyword value</span>
    type<span class="token operator">:</span> <span class="token string">&quot;array&quot;</span><span class="token punctuation">,</span>
    items<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    minItems<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    additionalItems<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">{</span>
  range<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  exclusiveRange<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> validate <span class="token operator">=</span> ajv<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>schema<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token number">2.01</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token number">3.99</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre></div><p>See note on errors and asynchronous keywords in the previous section.</p> <h3 id="define-keyword-with-macro-function"><a href="#define-keyword-with-macro-function" class="header-anchor">#</a> Define keyword with &quot;macro&quot; function</h3> <p>Keyword definition:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">MacroKeywordDefinition</span> <span class="token keyword">extends</span> <span class="token class-name">FuncKeywordDefinition</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">macro</span><span class="token operator">:</span> <span class="token punctuation">(</span>schema<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> parentSchema<span class="token operator">:</span> AnySchemaObject<span class="token punctuation">,</span> it<span class="token operator">:</span> SchemaCxt<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> AnySchema
<span class="token punctuation">}</span>
</code></pre></div><p>&quot;Macro&quot; function is called during schema compilation. It is passed schema, parent schema and <a href="#schema-compilation-context">schema compilation context</a> and it should return another schema that will be applied to the data in addition to the original schema.</p> <p>It is an efficient approach (in cases when the keyword logic can be expressed with another JSON Schema), because it is usually easy to implement and there is no extra function call during validation.</p> <p>In addition to the errors from the expanded schema macro keyword will add its own error in case validation fails.</p> <p>Example. <code>range</code> and <code>exclusiveRange</code> keywords from the previous example defined with macro:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>ajv<span class="token punctuation">.</span><span class="token function">addKeyword</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  keyword<span class="token operator">:</span> <span class="token string">&quot;range&quot;</span><span class="token punctuation">,</span>
  type<span class="token operator">:</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">macro</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>minimum<span class="token punctuation">,</span> maximum<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>minimum<span class="token punctuation">,</span> maximum<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// schema with keywords minimum and maximum</span>
  <span class="token comment">// metaSchema: the same as in the example above</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Macro keywords an be recursive - i.e. return schemas containing the same keyword. See the example of defining a recursive macro keyword <code>deepProperties</code> in the <a href="../spec/keyword.spec.ts#L316">test</a>.</p> <h2 id="schema-compilation-context"><a href="#schema-compilation-context" class="header-anchor">#</a> Schema compilation context</h2> <p>Schema compilation context <a href="https://github.com/ajv-validator/ajv/blob/master/lib/compile/index.ts" target="_blank" rel="noopener noreferrer">SchemaCxt<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is available in property <code>it</code> of <a href="https://github.com/ajv-validator/ajv/blob/master/lib/compile/context.ts" target="_blank" rel="noopener noreferrer">KeywordCxt<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (and it is also the 3rd parameter of <code>compile</code> and <code>macro</code> keyword functions). See types in the source code on the properties you can use in this object.</p> <h2 id="validation-time-variables"><a href="#validation-time-variables" class="header-anchor">#</a> Validation time variables</h2> <p>All function scoped variables available during validation are defined in <a href="https://github.com/ajv-validator/ajv/blob/master/lib/compile/names.ts" target="_blank" rel="noopener noreferrer">names<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="reporting-errors"><a href="#reporting-errors" class="header-anchor">#</a> Reporting errors</h2> <p>All keywords can define error messages with <code>KeywordErrorDefinition</code> object passed as <code>error</code> property of keyword definition:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">KeywordErrorDefinition</span> <span class="token punctuation">{</span>
  message<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>cxt<span class="token operator">:</span> KeywordErrorCxt<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Code<span class="token punctuation">)</span>
  params<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>cxt<span class="token operator">:</span> KeywordErrorCxt<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Code
<span class="token punctuation">}</span>
</code></pre></div><p><code>code</code> keywords can pass parameters to these functions via <code>cxt.setParams</code> (see implementations of pre-defined keywords), other keywords can only set a string message this way.</p> <p>Another approach for reporting errors can be used for <code>validate</code> and <code>compile</code> keyword - they can define errors by assigning them to <code>.errors</code> property of the validation function. Asynchronous keywords can return promise that rejects with <code>new Ajv.ValidationError(errors)</code>, where <code>errors</code> is an array of validation errors (if you don't want to create errors in asynchronous keyword, its validation function can return the promise that resolves with <code>false</code>).</p> <p>Each error object in <code>errors</code> array should at least have properties <code>keyword</code>, <code>message</code> and <code>params</code>, other properties will be added.</p> <p>If keyword doesn't define or return errors, the default error will be created in case the keyword fails validation.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ajv-validator/ajv/edit/master/docs/keywords.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/standalone.html" class="prev">
        Standalone validation code
      </a></span> <span class="next"><a href="/coercion.html">
        Type coercion rules
      </a>
      
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.329991f7.js" defer></script><script src="/assets/js/3.9bef8dc3.js" defer></script><script src="/assets/js/4.bc735718.js" defer></script><script src="/assets/js/18.77b5141f.js" defer></script><script src="/assets/js/50.85d21782.js" defer></script><script src="/assets/js/26.d39d70b1.js" defer></script>
  </body>
</html>
