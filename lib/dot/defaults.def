{{## def.assignDefault:
  if ({{=$passData}} === undefined)
    {{=$passData}} = {{? it.opts.useDefaults == 'shared' }}
                       {{= it.useDefault($sch.default) }}
                     {{?? it.opts.useDefaults == 'smart' && $sch.default === undefined }}
                       {{? $sch.type == 'object' || $sch.properties }}
                         {}
                       {{?? $sch.type == 'array' || $sch.items }}
                         []
                       {{??}}
                         undefined
                       {{?}}
                     {{??}}
                       {{= JSON.stringify($sch.default) }}
                     {{?}};
#}}


{{## def.defaultProperties:
  {{
    var $schema = it.schema.properties
      , $schemaKeys = Object.keys($schema); }}
  {{~ $schemaKeys:$propertyKey }}
    {{ var $sch = $schema[$propertyKey]; }}
    {{? $sch.default !== undefined || it.opts.useDefaults == 'smart' }}
      {{ var $passData = $data + it.util.getProperty($propertyKey); }}
      {{# def.assignDefault }}
    {{?}}
  {{~}}
#}}


{{## def.defaultItems:
  {{~ it.schema.items:$sch:$i }}
    {{? $sch.default !== undefined || it.opts.useDefaults == 'smart' }}
      {{ var $passData = $data + '[' + $i + ']'; }}
      {{# def.assignDefault }}
    {{?}}
  {{~}}
#}}
