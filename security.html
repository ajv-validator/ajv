<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Security considerations | Ajv JSON schema validator</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
    <meta name="description" content="The fastest JSON schema Validator. Supports JSON Schema draft-04/06/07/2019-09/2020-12 and JSON Type Definition (RFC8927)">
    <meta charset="utf-8">
    <meta property="og:title" content="Ajv JSON schema validator">
    <meta property="og:description" content="The fastest JSON schema Validator. Supports JSON Schema draft-04/06/07/2019-09/2020-12 and JSON Type Definition (RFC8927)">
    <meta property="og:image" content="https://ajv.js.org/img/ajv.png">
    <meta itemprop="image" content="https://ajv.js.org/img/ajv.png">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Ajv JSON schema validator">
    <meta name="twitter:image:src" content="https://ajv.js.org/img/ajv.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preload" href="/assets/css/0.styles.b97d33c8.css" as="style"><link rel="preload" href="/assets/js/app.9304b873.js" as="script"><link rel="preload" href="/assets/js/3.46c1c254.js" as="script"><link rel="preload" href="/assets/js/4.b79e234f.js" as="script"><link rel="preload" href="/assets/js/18.2b82ca74.js" as="script"><link rel="preload" href="/assets/js/67.4c9e9982.js" as="script"><link rel="prefetch" href="/assets/js/10.c1fa257b.js"><link rel="prefetch" href="/assets/js/11.e8ff0dce.js"><link rel="prefetch" href="/assets/js/12.82194d61.js"><link rel="prefetch" href="/assets/js/13.70a66ab0.js"><link rel="prefetch" href="/assets/js/14.bcab042e.js"><link rel="prefetch" href="/assets/js/15.7b3653d1.js"><link rel="prefetch" href="/assets/js/16.3f99720e.js"><link rel="prefetch" href="/assets/js/17.dfcdeba5.js"><link rel="prefetch" href="/assets/js/19.a4f6e035.js"><link rel="prefetch" href="/assets/js/2.e4e391de.js"><link rel="prefetch" href="/assets/js/20.691a5d59.js"><link rel="prefetch" href="/assets/js/21.863b43a1.js"><link rel="prefetch" href="/assets/js/22.77435682.js"><link rel="prefetch" href="/assets/js/23.282dd977.js"><link rel="prefetch" href="/assets/js/24.b840948b.js"><link rel="prefetch" href="/assets/js/25.2b170013.js"><link rel="prefetch" href="/assets/js/26.3bf4b8f1.js"><link rel="prefetch" href="/assets/js/27.8463b577.js"><link rel="prefetch" href="/assets/js/28.bad0ce29.js"><link rel="prefetch" href="/assets/js/29.1c07a252.js"><link rel="prefetch" href="/assets/js/30.558b050f.js"><link rel="prefetch" href="/assets/js/31.ec1a93ea.js"><link rel="prefetch" href="/assets/js/32.d3137974.js"><link rel="prefetch" href="/assets/js/33.a371a4e0.js"><link rel="prefetch" href="/assets/js/34.20e34d86.js"><link rel="prefetch" href="/assets/js/35.08c2a0c2.js"><link rel="prefetch" href="/assets/js/36.ee864235.js"><link rel="prefetch" href="/assets/js/37.d53496e8.js"><link rel="prefetch" href="/assets/js/38.dd2404c1.js"><link rel="prefetch" href="/assets/js/39.2e973d5a.js"><link rel="prefetch" href="/assets/js/40.284e07e1.js"><link rel="prefetch" href="/assets/js/41.67565ceb.js"><link rel="prefetch" href="/assets/js/42.37bd5bea.js"><link rel="prefetch" href="/assets/js/43.3ac7dfe4.js"><link rel="prefetch" href="/assets/js/44.e7196cc4.js"><link rel="prefetch" href="/assets/js/45.f648d71c.js"><link rel="prefetch" href="/assets/js/46.3c539638.js"><link rel="prefetch" href="/assets/js/47.f4162119.js"><link rel="prefetch" href="/assets/js/48.2fe9259f.js"><link rel="prefetch" href="/assets/js/49.dabd76d3.js"><link rel="prefetch" href="/assets/js/5.59c8dc68.js"><link rel="prefetch" href="/assets/js/50.0f9694ea.js"><link rel="prefetch" href="/assets/js/51.a6e128cf.js"><link rel="prefetch" href="/assets/js/52.fd699e22.js"><link rel="prefetch" href="/assets/js/53.07ed88c2.js"><link rel="prefetch" href="/assets/js/54.b4ba0d39.js"><link rel="prefetch" href="/assets/js/55.b11b5fb9.js"><link rel="prefetch" href="/assets/js/56.b8bbf968.js"><link rel="prefetch" href="/assets/js/57.ea772041.js"><link rel="prefetch" href="/assets/js/58.39e4a933.js"><link rel="prefetch" href="/assets/js/59.7a2cc935.js"><link rel="prefetch" href="/assets/js/6.00e270a5.js"><link rel="prefetch" href="/assets/js/60.f1bd99d7.js"><link rel="prefetch" href="/assets/js/61.4b3b3780.js"><link rel="prefetch" href="/assets/js/62.76281103.js"><link rel="prefetch" href="/assets/js/63.ba46d186.js"><link rel="prefetch" href="/assets/js/64.b4ac5176.js"><link rel="prefetch" href="/assets/js/65.e5b833e1.js"><link rel="prefetch" href="/assets/js/66.daae7470.js"><link rel="prefetch" href="/assets/js/68.269535bd.js"><link rel="prefetch" href="/assets/js/69.1c62b869.js"><link rel="prefetch" href="/assets/js/7.ca56b24b.js"><link rel="prefetch" href="/assets/js/70.8c076f30.js"><link rel="prefetch" href="/assets/js/71.d08fb6b1.js"><link rel="prefetch" href="/assets/js/8.8f4ed3e1.js"><link rel="prefetch" href="/assets/js/9.cfd14c73.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b97d33c8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/ajv.svg" alt="Ajv JSON schema validator" class="logo"> <span class="site-name can-hide">Ajv JSON schema validator</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guide" class="dropdown-title"><span class="title">Guide</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guide" class="mobile-dropdown-title"><span class="title">Guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/why-ajv.html" class="nav-link">
  Why use Ajv
</a></li><li class="dropdown-item"><!----> <a href="/guide/getting-started.html" class="nav-link">
  Getting started
</a></li><li class="dropdown-item"><!----> <a href="/guide/typescript.html" class="nav-link">
  Using with TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/guide/schema-language.html" class="nav-link">
  Choosing schema language
</a></li><li class="dropdown-item"><!----> <a href="/guide/managing-schemas.html" class="nav-link">
  Managing schemas
</a></li><li class="dropdown-item"><!----> <a href="/guide/combining-schemas.html" class="nav-link">
  Combining schemas
</a></li><li class="dropdown-item"><!----> <a href="/guide/formats.html" class="nav-link">
  Format validation
</a></li><li class="dropdown-item"><!----> <a href="/guide/modifying-data.html" class="nav-link">
  Modifying data
</a></li><li class="dropdown-item"><!----> <a href="/guide/user-keywords.html" class="nav-link">
  User-defined keywords
</a></li><li class="dropdown-item"><!----> <a href="/guide/async-validation.html" class="nav-link">
  Asynchronous validation
</a></li><li class="dropdown-item"><!----> <a href="/guide/environments.html" class="nav-link">
  Execution environments
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Reference" class="dropdown-title"><span class="title">Reference</span> <span class="arrow down"></span></button> <button type="button" aria-label="Reference" class="mobile-dropdown-title"><span class="title">Reference</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/api.html" class="nav-link">
  API Reference
</a></li><li class="dropdown-item"><!----> <a href="/options.html" class="nav-link">
  Ajv options
</a></li><li class="dropdown-item"><!----> <a href="/json-schema.html" class="nav-link">
  JSON Schema
</a></li><li class="dropdown-item"><!----> <a href="/json-type-definition.html" class="nav-link">
  JSON Type Definition
</a></li><li class="dropdown-item"><!----> <a href="/strict-mode.html" class="nav-link">
  Strict mode
</a></li><li class="dropdown-item"><!----> <a href="/standalone.html" class="nav-link">
  Standalone validation code
</a></li><li class="dropdown-item"><!----> <a href="/keywords.html" class="nav-link">
  User defined keywords
</a></li><li class="dropdown-item"><!----> <a href="/coercion.html" class="nav-link">
  Type coercion rules
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Learn more" class="dropdown-title"><span class="title">Learn more</span> <span class="arrow down"></span></button> <button type="button" aria-label="Learn more" class="mobile-dropdown-title"><span class="title">Learn more</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Extending Ajv
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/packages/" class="nav-link">
  Extending Ajv
</a></li><li class="dropdown-subitem"><a href="/packages/ajv-cli.html" class="nav-link">
  ajv-cli
</a></li><li class="dropdown-subitem"><a href="/packages/ajv-errors.html" class="nav-link">
  ajv-errors
</a></li><li class="dropdown-subitem"><a href="/packages/ajv-formats.html" class="nav-link">
  ajv-formats
</a></li><li class="dropdown-subitem"><a href="/packages/ajv-i18n.html" class="nav-link">
  ajv-i18n
</a></li><li class="dropdown-subitem"><a href="/packages/ajv-keywords.html" class="nav-link">
  ajv-keywords
</a></li></ul></li><li class="dropdown-item"><h4>
          Contributors
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/contributing.html" class="nav-link">
  Contributing guide
</a></li><li class="dropdown-subitem"><a href="/codegen.html" class="nav-link">
  Code generation design
</a></li><li class="dropdown-subitem"><a href="/components.html" class="nav-link">
  Code components
</a></li><li class="dropdown-subitem"><a href="/code_of_conduct.html" class="nav-link">
  Code of Conduct
</a></li></ul></li><li class="dropdown-item"><h4>
          Information
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/news/" class="nav-link">
  News
</a></li><li class="dropdown-subitem"><a href="/faq.html" class="nav-link">
  FAQ
</a></li><li class="dropdown-subitem"><a href="/security.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Security
</a></li><li class="dropdown-subitem"><a href="/v6-to-v8-migration.html" class="nav-link">
  Migrate from v6
</a></li><li class="dropdown-subitem"><a href="/testimonials.html" class="nav-link">
  What users say
</a></li><li class="dropdown-subitem"><a href="/license.html" class="nav-link">
  License
</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guide" class="dropdown-title"><span class="title">Guide</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guide" class="mobile-dropdown-title"><span class="title">Guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/why-ajv.html" class="nav-link">
  Why use Ajv
</a></li><li class="dropdown-item"><!----> <a href="/guide/getting-started.html" class="nav-link">
  Getting started
</a></li><li class="dropdown-item"><!----> <a href="/guide/typescript.html" class="nav-link">
  Using with TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/guide/schema-language.html" class="nav-link">
  Choosing schema language
</a></li><li class="dropdown-item"><!----> <a href="/guide/managing-schemas.html" class="nav-link">
  Managing schemas
</a></li><li class="dropdown-item"><!----> <a href="/guide/combining-schemas.html" class="nav-link">
  Combining schemas
</a></li><li class="dropdown-item"><!----> <a href="/guide/formats.html" class="nav-link">
  Format validation
</a></li><li class="dropdown-item"><!----> <a href="/guide/modifying-data.html" class="nav-link">
  Modifying data
</a></li><li class="dropdown-item"><!----> <a href="/guide/user-keywords.html" class="nav-link">
  User-defined keywords
</a></li><li class="dropdown-item"><!----> <a href="/guide/async-validation.html" class="nav-link">
  Asynchronous validation
</a></li><li class="dropdown-item"><!----> <a href="/guide/environments.html" class="nav-link">
  Execution environments
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Reference" class="dropdown-title"><span class="title">Reference</span> <span class="arrow down"></span></button> <button type="button" aria-label="Reference" class="mobile-dropdown-title"><span class="title">Reference</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/api.html" class="nav-link">
  API Reference
</a></li><li class="dropdown-item"><!----> <a href="/options.html" class="nav-link">
  Ajv options
</a></li><li class="dropdown-item"><!----> <a href="/json-schema.html" class="nav-link">
  JSON Schema
</a></li><li class="dropdown-item"><!----> <a href="/json-type-definition.html" class="nav-link">
  JSON Type Definition
</a></li><li class="dropdown-item"><!----> <a href="/strict-mode.html" class="nav-link">
  Strict mode
</a></li><li class="dropdown-item"><!----> <a href="/standalone.html" class="nav-link">
  Standalone validation code
</a></li><li class="dropdown-item"><!----> <a href="/keywords.html" class="nav-link">
  User defined keywords
</a></li><li class="dropdown-item"><!----> <a href="/coercion.html" class="nav-link">
  Type coercion rules
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Learn more" class="dropdown-title"><span class="title">Learn more</span> <span class="arrow down"></span></button> <button type="button" aria-label="Learn more" class="mobile-dropdown-title"><span class="title">Learn more</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Extending Ajv
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/packages/" class="nav-link">
  Extending Ajv
</a></li><li class="dropdown-subitem"><a href="/packages/ajv-cli.html" class="nav-link">
  ajv-cli
</a></li><li class="dropdown-subitem"><a href="/packages/ajv-errors.html" class="nav-link">
  ajv-errors
</a></li><li class="dropdown-subitem"><a href="/packages/ajv-formats.html" class="nav-link">
  ajv-formats
</a></li><li class="dropdown-subitem"><a href="/packages/ajv-i18n.html" class="nav-link">
  ajv-i18n
</a></li><li class="dropdown-subitem"><a href="/packages/ajv-keywords.html" class="nav-link">
  ajv-keywords
</a></li></ul></li><li class="dropdown-item"><h4>
          Contributors
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/contributing.html" class="nav-link">
  Contributing guide
</a></li><li class="dropdown-subitem"><a href="/codegen.html" class="nav-link">
  Code generation design
</a></li><li class="dropdown-subitem"><a href="/components.html" class="nav-link">
  Code components
</a></li><li class="dropdown-subitem"><a href="/code_of_conduct.html" class="nav-link">
  Code of Conduct
</a></li></ul></li><li class="dropdown-item"><h4>
          Information
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/news/" class="nav-link">
  News
</a></li><li class="dropdown-subitem"><a href="/faq.html" class="nav-link">
  FAQ
</a></li><li class="dropdown-subitem"><a href="/security.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Security
</a></li><li class="dropdown-subitem"><a href="/v6-to-v8-migration.html" class="nav-link">
  Migrate from v6
</a></li><li class="dropdown-subitem"><a href="/testimonials.html" class="nav-link">
  What users say
</a></li><li class="dropdown-subitem"><a href="/license.html" class="nav-link">
  License
</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Reference</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Extending Ajv</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Contributors</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Information</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/news/" class="sidebar-link">Ajv News</a></li><li><a href="/faq.html" class="sidebar-link">Frequently Asked Questions</a></li><li><a href="/security.html" aria-current="page" class="active sidebar-link">Security considerations</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/security.html#security-contact" class="sidebar-link">Security contact</a></li><li class="sidebar-sub-header"><a href="/security.html#untrusted-schemas" class="sidebar-link">Untrusted schemas</a></li><li class="sidebar-sub-header"><a href="/security.html#circular-references-in-javascript-objects" class="sidebar-link">Circular references in JavaScript objects</a></li><li class="sidebar-sub-header"><a href="/security.html#security-risks-of-trusted-schemas" class="sidebar-link">Security risks of trusted schemas</a></li><li class="sidebar-sub-header"><a href="/security.html#redos-attack" class="sidebar-link">ReDoS attack</a></li><li class="sidebar-sub-header"><a href="/security.html#content-security-policy" class="sidebar-link">Content Security Policy</a></li></ul></li><li><a href="/v6-to-v8-migration.html" class="sidebar-link">Migrate from v6 to v8</a></li><li><a href="/testimonials.html" class="sidebar-link">What users say</a></li><li><a href="/license.html" class="sidebar-link">License</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="security-considerations"><a href="#security-considerations" class="header-anchor">#</a> Security considerations</h1> <p>JSON Schema, if properly used, can replace data sanitisation. It doesn't replace other API security considerations. It also introduces additional security aspects to consider.</p> <p></p><div class="table-of-contents"><ul><li><a href="#security-contact">Security contact</a></li><li><a href="#untrusted-schemas">Untrusted schemas</a></li><li><a href="#circular-references-in-javascript-objects">Circular references in JavaScript objects</a></li><li><a href="#security-risks-of-trusted-schemas">Security risks of trusted schemas</a></li><li><a href="#redos-attack">ReDoS attack</a></li><li><a href="#content-security-policy">Content Security Policy</a></li></ul></div><p></p> <h2 id="security-contact"><a href="#security-contact" class="header-anchor">#</a> Security contact</h2> <p>To report a security vulnerability, please use the
<a href="https://tidelift.com/security" target="_blank" rel="noopener noreferrer">Tidelift security contact<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.
Tidelift will coordinate the fix and disclosure. Please do NOT report security vulnerabilities via GitHub issues.</p> <h2 id="untrusted-schemas"><a href="#untrusted-schemas" class="header-anchor">#</a> Untrusted schemas</h2> <p>Ajv treats JSON schemas as trusted as your application code. This security model is based on the most common use case, when the schemas are static and bundled together with the application.</p> <p>If your schemas are received from untrusted sources (or generated from untrusted data) there are several scenarios you need to prevent:</p> <ul><li>compiling schemas can cause stack overflow (if they are too deep)</li> <li>compiling schemas can be slow (e.g. <a href="https://github.com/ajv-validator/ajv/issues/557" target="_blank" rel="noopener noreferrer">#557<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</li> <li>validating certain data can be slow</li></ul> <p>It is difficult to predict all the scenarios, but at the very least it may help to limit the size of untrusted schemas (e.g. limit JSON string length) and also the maximum schema object depth (that can be high for relatively small JSON strings). You also may want to mitigate slow regular expressions in <code>pattern</code> and <code>patternProperties</code> keywords.</p> <p>Regardless the measures you take, using untrusted schemas increases security risks.</p> <h2 id="circular-references-in-javascript-objects"><a href="#circular-references-in-javascript-objects" class="header-anchor">#</a> Circular references in JavaScript objects</h2> <p>Ajv does not support schemas and validated data that have circular references in objects. See <a href="https://github.com/ajv-validator/ajv/issues/802" target="_blank" rel="noopener noreferrer">issue #802<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>An attempt to compile such schemas or validate such data would cause stack overflow (or will not complete in case of asynchronous validation). Depending on the parser you use, untrusted data can lead to circular references.</p> <h2 id="security-risks-of-trusted-schemas"><a href="#security-risks-of-trusted-schemas" class="header-anchor">#</a> Security risks of trusted schemas</h2> <p>Some keywords in JSON Schemas can lead to very slow validation for certain data. These keywords include (but may be not limited to):</p> <ul><li><code>pattern</code> and <code>format</code> for large strings - in some cases using <code>maxLength</code> can help mitigate it, but certain regular expressions can lead to exponential validation time even with relatively short strings (see <a href="#redos-attack">ReDoS attack</a>).</li> <li><code>patternProperties</code> for large property names - use <code>propertyNames</code> to mitigate, but some regular expressions can have exponential evaluation time as well.</li> <li><code>uniqueItems</code> for large non-scalar arrays - use <code>maxItems</code> to mitigate</li></ul> <div class="custom-block danger"><p class="custom-block-title">Do NOT use allErrors in production</p> <p>The suggestions above to prevent slow validation would only work if you do NOT use <code>allErrors: true</code> in production code (using it would continue validation after validation errors).</p></div> <p>You can validate your JSON schemas against <a href="https://github.com/ajv-validator/ajv/blob/master/lib/refs/json-schema-secure.json" target="_blank" rel="noopener noreferrer">this meta-schema<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to check that these recommendations are followed:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>ajv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ajv</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">strictTypes</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// this option is required for this schema</span>
<span class="token keyword">const</span> isSchemaSecure <span class="token operator">=</span> ajv<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;ajv/lib/refs/json-schema-secure.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> schema1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&quot;email&quot;</span><span class="token punctuation">}</span>
<span class="token function">isSchemaSecure</span><span class="token punctuation">(</span>schema1<span class="token punctuation">)</span> <span class="token comment">// false</span>

<span class="token keyword">const</span> schema2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">maxLength</span><span class="token operator">:</span> <span class="token constant">MAX_LENGTH</span><span class="token punctuation">}</span>
<span class="token function">isSchemaSecure</span><span class="token punctuation">(</span>schema2<span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">Untrusted data</p> <p>Following all these recommendation is not a guarantee that validation using of untrusted data is safe - it can still lead to some undesirable results.</p></div> <h2 id="redos-attack"><a href="#redos-attack" class="header-anchor">#</a> ReDoS attack</h2> <p>Certain regular expressions can lead to the exponential evaluation time even with relatively short strings.</p> <p>Please assess the regular expressions you use in the schemas on their vulnerability to this attack - see <a href="https://github.com/substack/safe-regex" target="_blank" rel="noopener noreferrer">safe-regex<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, for example.</p> <p>By default, Ajv uses the regex engine built into Node.js. This engine has exponential worst-case performance. This performance (and ReDoS attacks) can be mitigated by using a linear-time regex engine. Ajv supports the use of a third-party regex engine for this purpose.</p> <p>To use a third-party regex engine in Ajv, set the ajv.opts.code.regExp property to that regex engine during instantiation. Here we use Google’s RE2 engine as an example.</p> <div class="language- extra-class"><pre class="language-text"><code>const Ajv = require(&quot;ajv&quot;) 
const RE2 = require(&quot;re2&quot;) 
const ajv = new Ajv({regExp: RE2}) 
</code></pre></div><p>For details about the interface of the <code>regexp</code> option, see options.md under the docs folder.</p> <p>Although linear-time regex engines eliminate ReDoS vulnerabilities, changing a regex engine carries some risk, including:</p> <ul><li>Minor changes in regex syntax.</li> <li>Minor changes in regex semantics. For example, RE2 always interprets regexes in Unicode, and disagrees with JavaScript in its definition of whitespace. To avoid regressions, develop and test your regexes in the same regex engine that you use in production.</li> <li>May not support some advanced features, such as look-aheads or back-references.</li> <li>May have (minor) common-case performance degradation.</li> <li>Increases size of distributable (e.g. RE2 includes a non-trivial C component).</li></ul> <div class="custom-block warning"><p class="custom-block-title">ReDoS attack</p> <p>Some formats that <a href="https://github.com/ajv-validator/ajv-formats" target="_blank" rel="noopener noreferrer">ajv-formats<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> package implements use <a href="https://github.com/ajv-validator/ajv-formats/blob/master/src/formats.ts" target="_blank" rel="noopener noreferrer">regular expressions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> that can be vulnerable to ReDoS attack.</p></div> <p>If you use Ajv to validate data from untrusted sources <strong>it is strongly recommended</strong> to consider the following:</p> <ul><li>making assessment of &quot;format&quot; implementations in <a href="https://github.com/ajv-validator/ajv-formats" target="_blank" rel="noopener noreferrer">ajv-formats<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</li> <li>passing <code>&quot;fast&quot;</code> option to ajv-formats plugin (see its docs) that simplifies some of the regular expressions (although it does not guarantee that they are safe).</li> <li>replacing format implementations provided by ajv-formats with your own implementations of &quot;format&quot; keyword that either use different regular expressions or another approach to format validation. Please see <a href="#api-addformat">addFormat</a> method.</li> <li>disabling format validation by ignoring &quot;format&quot; keyword with option <code>format: false</code></li></ul> <p>Whatever mitigation you choose, please assume all formats provided by ajv-formats as potentially unsafe and make your own assessment of their suitability for your validation scenarios.</p> <h2 id="content-security-policy"><a href="#content-security-policy" class="header-anchor">#</a> Content Security Policy</h2> <p>When using Ajv in a browser page with enabled Content Security Policy (CSP), <code>script-src</code> directive must include <code>'unsafe-eval'</code>.</p> <div class="custom-block danger"><p class="custom-block-title">Cross-site scripting attacks</p> <p><code>unsafe-eval</code> is NOT recommended in a secure CSP<a href="https://developer.chrome.com/extensions/contentSecurityPolicy#relaxing-eval" target="_blank" rel="noopener noreferrer">[1]<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, as it has the potential to open the document to cross-site scripting (XSS) attacks.</p></div> <p>In order to use Ajv without relaxing CSP, you can <a href="https://github.com/ajv-validator/ajv-cli#compile-schemas" target="_blank" rel="noopener noreferrer">compile the schemas using CLI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> or programmatically in your build code - see <a href="/standalone.html">Standalone validation code</a>. Compiled JavaScript file can export one or several validation functions that have the same code as the schemas compiled at runtime.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ajv-validator/ajv/edit/master/docs/security.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/faq.html" class="prev">
        Frequently Asked Questions
      </a></span> <span class="next"><a href="/v6-to-v8-migration.html">
        Migrate from v6 to v8
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9304b873.js" defer></script><script src="/assets/js/3.46c1c254.js" defer></script><script src="/assets/js/4.b79e234f.js" defer></script><script src="/assets/js/18.2b82ca74.js" defer></script><script src="/assets/js/67.4c9e9982.js" defer></script>
  </body>
</html>
